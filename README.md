# Cadance-judgment

音楽情報処理に基づいた音楽理論の論理シミュレーター（推論エンジン）を作るにおいてプロトタイプ
のためののコード置き場です。

コードの判定を音名(例えばGb4などの)組み合わせから行います。

Created with gemini

# 音楽理論論理シミュレータ (Cadence-Judgment) 仕様書
1. プロジェクト概要
本システムは、入力された音の集合（Note）から、音楽理論に基づくコードネームの判定、コード進行（カデンツ）の意味的解釈、およびボイスリーディングの滑らかさ、メロディとの音響学的な整合性を定量的に評価・出力する推論エンジンである。
物理的（周波数比・絶対半音数）な数値を基盤とし、辞書ベースのパターンマッチングと動的生成を組み合わせることで、高い網羅性と拡張性を実現している。

2. システムアーキテクチャとモジュール構成
システムは大きく「データモデル」「辞書群」「解析エンジン（推論器）」の3層で構成される。

2.1 データモデル (models/)
Note クラス (note.py): 音名（Step）、変化記号（Alter）、オクターブを保持し、計算の基礎となる「ピッチクラス（0~11）」および「絶対半音数（C0を起点とした整数）」に変換する。

2.2 辞書群 (dictionaries/)
CHORD_DICT (chord_dict.py): インターバルの集合をキーとして、対応するコードクオリティを返す。完全一致による高精度な判定を担う。

CADENCE_DICT (cadence_dict.py): ディグリー（度数）の遷移とコードクオリティの条件に基づいて、進行の名称（例: "正格終止"、"エオリアン・カデンツ"）と付与されるボーナススコアを定義する。

INTERVAL_INFO_DICT (interval_dict.py): 各音程の協和・不協和の分類、および純正律における理想的な周波数比（例: P4 = 4:3）を保持する。

2.3 解析エンジン (engine/)
ChordAnalyzer (analyzer.py): 音のリストを受け取り、コードネームの候補をスコア付きで算出する。

TransitionAnalyzer (transition_analyzer.py): 2つのコード間のボイスリーディング（各構成音の移動量）を計算し、CADENCE_DICT を参照して進行の機能的評価を行う。

ProgressionAnalyzer (progression_analyzer.py): 複数のコード進行を自動で連続解析し、全体の一貫したレポートを生成する。

MelodyAnalyzer (melody_analyzer.py): メロディ音とコード構成音の衝突（アヴォイドノート）を、理論と物理（周波数比）の両面から検知する。

RuleBasedGenerator (fallback_generator.py): 辞書にない未知のテンション和音に対し、構成音から動的にコードネームを生成する。

DegreeConverter (degree_converter.py): 絶対音程のコードを、指定されたKeyに基づくディグリーネーム（I, bVIIなど）に変換する。

3. 主要機能の動作仕様
3.1 単体コード判定 (ChordAnalyzer)
入力された音のリストに対し、以下の4つのフェーズで多角的に探索を行う。

通常探索: ベース音または構成音を仮のルートとし、その他の音とのインターバルを計算。CHORD_DICT と照合する。

ルートレス探索: 構成音に含まれないピッチクラスを仮想ルートと仮定し、テンションコードとして成立するかを検証する。

UST / ポリコード探索: 4音以上の入力に対し、上部構造（トライアド）が分離可能か判定する。

動的生成: 上記で見つからない場合、RuleBasedGenerator により、3度・5度・7度の骨格判定とテンションの抽出からコードネームを動的に生成する。

3.2 遷移・進行解析 (TransitionAnalyzer)
2つの和音（Chord A -> Chord B）間の関係性を評価する。

ボイスリーディング計算:
各構成音の絶対半音数を比較し、最も移動量の少ない音の結びつきを導出する。保留音（Common Tone）が多いほど、また総移動半音数が少ないほど高く評価される。

カデンツ（進行機能）評価:
CADENCE_DICT を走査し、条件に合致する「最もボーナススコアの高い」機能名を採用する。

優先順位付け: 複数のルールに合致した場合、スコア（エモさ）が高い専門的なルールを優先し、汎用的な進行（全音上行など）は次点候補として保持する。

3.3 メロディ整合性判定 (MelodyAnalyzer)
理論的アヴォイド: メジャーコードにおける完全4度（P4）等の衝突を検知。

音響学的不協和: interval_dict の周波数比を用い、m9（32:15）などの物理的に激しい「うなり」が発生する組み合わせを数値的に特定する。

4. スコアリング仕様
コード単体スコア: 基本形（最大80点）。転回形やオンコードは、ベース音の不安定さに応じて減点。

ボイスリーディングスコア: 80 - (総移動半音数 * 2) + (保留音の数 * 10)。物理的な指の動きや声部の滑らかさを評価。

カデンツボーナス: CADENCE_DICT に定義された理論的・感情的な重要度に基づく加点（0〜30点）。

5. 拡張方法
コードの追加: chord_dict.py に frozenset とコードネームを追記。

進行ルールの追加: cadence_dict.py に新しいディグリー遷移条件を追加。これにより、ジャンル特有の「エモい進行」を即座に認識可能になる。

# 実装したいもの
1. 実践に応じた適切なコードを出力するためのスコアリング(点数化)
2. 鍵盤対応
3. 様々なコードの表記への対応(key,scale,degreeに応じたコードシンボルの表記など)
4. コードの表記ブレへの対応

## Acknowledgements / Credits
本ツールの開発にあたり、先行する和音判定ツールである Chord Finder（作成者: kkkgg氏）の実装を参考にさせていただきました。https://github.com/kkkgg/chord_finder
